<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Retail Enterprise Distribution Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f8fafc;
            color: #1e293b;
        }
        .header {
            background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);
            padding: 20px 40px;
            text-align: center;
            border-bottom: 1px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .header h1 {
            font-size: 28px;
            font-weight: 600;
            color: #e94560;
            margin-bottom: 8px;
        }
        .header p {
            color: #64748b;
            font-size: 14px;
        }
        .container {
            display: flex;
            height: calc(100vh - 100px);
        }
        #map {
            flex: 1;
            height: 100%;
        }
        .sidebar {
            width: 320px;
            background: #ffffff;
            padding: 20px;
            overflow-y: auto;
            border-left: 1px solid #e2e8f0;
            box-shadow: -2px 0 8px rgba(0,0,0,0.05);
        }
        .legend {
            margin-bottom: 24px;
        }
        .legend h3 {
            font-size: 14px;
            color: #e94560;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
            color: #475569;
        }
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid rgba(0,0,0,0.1);
        }
        .stats-section {
            margin-bottom: 24px;
        }
        .stats-section h3 {
            font-size: 14px;
            color: #e94560;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .stat-card {
            background: #f8fafc;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 8px;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.2s;
        }
        .stat-card:hover {
            background: #e2e8f0;
            transform: translateX(4px);
        }
        .stat-card.active {
            background: #e94560;
            border-color: #e94560;
        }
        .stat-card.active .region,
        .stat-card.active .value,
        .stat-card.active .label {
            color: #ffffff;
        }
        .stat-card .region {
            font-size: 12px;
            color: #64748b;
            margin-bottom: 4px;
        }
        .stat-card .value {
            font-size: 20px;
            font-weight: 600;
            color: #1e293b;
        }
        .stat-card .label {
            font-size: 11px;
            color: #94a3b8;
        }
        .city-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .city-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: #f8fafc;
            border-radius: 6px;
            margin-bottom: 6px;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            transition: all 0.2s;
        }
        .city-item:hover {
            background: #e2e8f0;
            transform: translateX(4px);
        }
        .city-name {
            font-size: 13px;
            font-weight: 500;
            color: #334155;
        }
        .city-count {
            font-size: 14px;
            font-weight: 600;
            color: #e94560;
        }
        .leaflet-popup-content-wrapper {
            background: #ffffff;
            color: #1e293b;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
        }
        .leaflet-popup-tip {
            background: #ffffff;
        }
        .leaflet-popup-content {
            margin: 16px 20px;
        }
        .popup-city {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 4px;
        }
        .popup-region {
            font-size: 12px;
            color: #64748b;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e2e8f0;
        }
        .popup-stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .popup-stat-label {
            color: #64748b;
            font-size: 12px;
        }
        .popup-stat-value {
            font-weight: 600;
            font-size: 14px;
            color: #334155;
        }
        .popup-stat-value.highlight {
            color: #e94560;
        }
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: 300px;
                border-left: none;
                border-top: 1px solid #e2e8f0;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Global Retail Enterprise Distribution</h1>
        <p>Interactive visualization of retail industry data across 20 cities + 9 customer regions</p>
    </div>
    <div class="container">
        <div id="map"></div>
        <div class="sidebar">
            <div class="legend">
                <h3>Region Legend</h3>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e94560;"></div>
                    <span>Middle East</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #0ea5e9;"></div>
                    <span>Asia Pacific</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #22c55e;"></div>
                    <span>North America</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f59e0b;"></div>
                    <span>Latin America</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #8b5cf6;"></div>
                    <span>Europe</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #6b7280;"></div>
                    <span>Customer Regions</span>
                </div>
            </div>
            <div class="stats-section">
                <h3>Regional Statistics</h3>
                <div class="stat-card" data-region="all">
                    <div class="region">All Regions</div>
                    <div class="value">7,295</div>
                    <div class="label">Total Retail Enterprises (20 cities)</div>
                </div>
                <div class="stat-card" data-region="Latin America">
                    <div class="region">Latin America</div>
                    <div class="value">2,699</div>
                    <div class="label">Total Retail Enterprises (3 cities)</div>
                </div>
                <div class="stat-card" data-region="North America">
                    <div class="region">North America</div>
                    <div class="value">1,596</div>
                    <div class="label">Total Retail Enterprises (8 cities)</div>
                </div>
                <div class="stat-card" data-region="Europe">
                    <div class="region">Europe</div>
                    <div class="value">1,567</div>
                    <div class="label">Total Retail Enterprises (7 cities)</div>
                </div>
                <div class="stat-card" data-region="Asia Pacific">
                    <div class="region">Asia Pacific</div>
                    <div class="value">1,000</div>
                    <div class="label">Total Retail Enterprises (4 cities)</div>
                </div>
                <div class="stat-card" data-region="Middle East">
                    <div class="region">Middle East</div>
                    <div class="value">433</div>
                    <div class="label">Total Retail Enterprises (2 cities)</div>
                </div>
            </div>
            <div class="stats-section">
                <h3>City Ranking (by Enterprises)</h3>
                <div class="city-list" id="cityList"></div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const cities = [
            { name: "Riyadh", region: "Middle East", lat: 24.7136, lng: 46.6753, enterprises: 129, gdp: 230, population: 7.5 },
            { name: "Dubai", region: "Middle East", lat: 25.2048, lng: 55.2708, enterprises: 304, gdp: 180, population: 3.6 },
            { name: "Sydney", region: "Asia Pacific", lat: -33.8688, lng: 151.2093, enterprises: 256, gdp: 500, population: 5.3 },
            { name: "Singapore", region: "Asia Pacific", lat: 1.3521, lng: 103.8198, enterprises: 133, gdp: 400, population: 5.9 },
            { name: "Kuala Lumpur", region: "Asia Pacific", lat: 3.1390, lng: 101.6869, enterprises: 157, gdp: 190, population: 8 },
            { name: "Jakarta", region: "Asia Pacific", lat: -6.2088, lng: 106.8456, enterprises: 454, gdp: 320, population: 11 },
            { name: "China", region: "Customer Regions", lat: 35.8617, lng: 104.1954, enterprises: null, gdp: null, population: null, isCustomer: true },
            { name: "South Korea", region: "Customer Regions", lat: 35.9078, lng: 127.7669, enterprises: null, gdp: null, population: null, isCustomer: true },
            { name: "Turkey", region: "Customer Regions", lat: 38.9637, lng: 35.2433, enterprises: null, gdp: null, population: null, isCustomer: true },
            { name: "Egypt", region: "Customer Regions", lat: 26.8206, lng: 30.8025, enterprises: null, gdp: null, population: null, isCustomer: true },
            { name: "Iraq", region: "Customer Regions", lat: 33.2232, lng: 43.6793, enterprises: null, gdp: null, population: null, isCustomer: true },
            { name: "Hong Kong", region: "Customer Regions", lat: 22.3193, lng: 114.1694, enterprises: null, gdp: null, population: null, isCustomer: true },
            { name: "Taiwan", region: "Customer Regions", lat: 23.6978, lng: 120.9605, enterprises: null, gdp: null, population: null, isCustomer: true },
            { name: "Japan", region: "Customer Regions", lat: 36.2048, lng: 138.2529, enterprises: null, gdp: null, population: null, isCustomer: true },
            { name: "Morocco", region: "Customer Regions", lat: 31.7917, lng: -7.0926, enterprises: null, gdp: null, population: null, isCustomer: true },
            { name: "Washington DC", region: "North America", lat: 38.9072, lng: -77.0369, enterprises: 134, gdp: 600, population: 6.4 },
            { name: "Portland", region: "North America", lat: 45.5152, lng: -122.6784, enterprises: 37, gdp: 200, population: 2.5 },
            { name: "Vancouver", region: "North America", lat: 49.2827, lng: -123.1207, enterprises: 51, gdp: 150, population: 2.7 },
            { name: "Toronto", region: "North America", lat: 43.6532, lng: -79.3832, enterprises: 121, gdp: 450, population: 6.7 },
            { name: "Seattle", region: "North America", lat: 47.6062, lng: -122.3321, enterprises: 119, gdp: 500, population: 4.1 },
            { name: "New York", region: "North America", lat: 40.7128, lng: -74.0060, enterprises: 676, gdp: 2100, population: 20 },
            { name: "Los Angeles", region: "North America", lat: 34.0522, lng: -118.2437, enterprises: 209, gdp: 1100, population: 13 },
            { name: "San Francisco", region: "North America", lat: 37.7749, lng: -122.4194, enterprises: 249, gdp: 900, population: 4.6 },
            { name: "SÃ£o Paulo", region: "Latin America", lat: -23.5505, lng: -46.6333, enterprises: 2500, gdp: 430, population: 22 },
            { name: "Santiago", region: "Latin America", lat: -33.4489, lng: -70.6693, enterprises: 143, gdp: 160, population: 7 },
            { name: "Mexico City", region: "Latin America", lat: 19.4326, lng: -99.1332, enterprises: 56, gdp: 410, population: 22 },
            { name: "London", region: "Europe", lat: 51.5074, lng: -0.1278, enterprises: 652, gdp: 850, population: 9.5 },
            { name: "Paris", region: "Europe", lat: 48.8566, lng: 2.3522, enterprises: 388, gdp: 760, population: 11 },
            { name: "Berlin", region: "Europe", lat: 52.5200, lng: 13.4050, enterprises: 49, gdp: 180, population: 3.6 },
            { name: "Rome", region: "Europe", lat: 41.9028, lng: 12.4964, enterprises: 69, gdp: 170, population: 4.3 },
            { name: "Madrid", region: "Europe", lat: 40.4168, lng: -3.7038, enterprises: 172, gdp: 280, population: 6.7 },
            { name: "Barcelona", region: "Europe", lat: 41.3851, lng: 2.1734, enterprises: 157, gdp: 200, population: 5.6 },
            { name: "Amsterdam", region: "Europe", lat: 52.3676, lng: 4.9041, enterprises: 80, gdp: 190, population: 2.5 }
        ];

        const regionColors = {
            "Middle East": "#e94560",
            "Asia Pacific": "#0ea5e9",
            "North America": "#22c55e",
            "Latin America": "#f59e0b",
            "Europe": "#8b5cf6",
            "Customer Regions": "#6b7280"
        };

        // Initialize map with light theme
        const map = L.map('map', {
            center: [30, 20],
            zoom: 2,
            minZoom: 2,
            maxZoom: 10
        });

        // Add light tile layer
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        // Calculate marker size based on enterprise count
        function getMarkerSize(enterprises, isCustomer) {
            if (isCustomer) return 20; // Fixed size for customer regions
            const minSize = 14;
            const maxSize = 50;
            const maxEnterprises = 2500;
            return minSize + (enterprises / maxEnterprises) * (maxSize - minSize);
        }

        // Create markers
        const markers = [];
        cities.forEach(city => {
            const size = getMarkerSize(city.enterprises, city.isCustomer);
            const color = regionColors[city.region];

            const icon = L.divIcon({
                className: 'custom-marker',
                html: `<div style="
                    width: ${size}px;
                    height: ${size}px;
                    background: ${color};
                    border-radius: 50%;
                    border: 3px solid rgba(255,255,255,0.9);
                    box-shadow: 0 4px 12px ${color}80, 0 2px 6px rgba(0,0,0,0.2);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-size: ${Math.max(10, size/3)}px;
                    font-weight: bold;
                "></div>`,
                iconSize: [size, size],
                iconAnchor: [size/2, size/2]
            });

            const popupContent = city.isCustomer
                ? `
                    <div class="popup-city">${city.name}</div>
                    <div class="popup-region">${city.region}</div>
                    <div class="popup-stat">
                        <span class="popup-stat-label">Status</span>
                        <span class="popup-stat-value highlight">Customer Region</span>
                    </div>
                `
                : `
                    <div class="popup-city">${city.name}</div>
                    <div class="popup-region">${city.region}</div>
                    <div class="popup-stat">
                        <span class="popup-stat-label">Retail Enterprises</span>
                        <span class="popup-stat-value highlight">${city.enterprises}</span>
                    </div>
                    <div class="popup-stat">
                        <span class="popup-stat-label">GDP</span>
                        <span class="popup-stat-value">~$${city.gdp}B</span>
                    </div>
                    <div class="popup-stat">
                        <span class="popup-stat-label">Population</span>
                        <span class="popup-stat-value">~${city.population}M</span>
                    </div>
                `;

            const marker = L.marker([city.lat, city.lng], { icon })
                .addTo(map)
                .bindPopup(popupContent, {
                    closeButton: false
                });

            markers.push({ marker, city });
        });

        // City list element
        const cityList = document.getElementById('cityList');

        // Function to populate city list based on selected region
        function populateCityList(selectedRegion = 'all') {
            cityList.innerHTML = '';

            let filteredCities;
            if (selectedRegion === 'all') {
                filteredCities = cities.filter(c => !c.isCustomer);
            } else if (selectedRegion === 'Customer Regions') {
                filteredCities = cities.filter(c => c.isCustomer);
            } else {
                filteredCities = cities.filter(c => c.region === selectedRegion && !c.isCustomer);
            }

            const sortedCities = [...filteredCities].sort((a, b) => {
                if (a.enterprises === null) return 1;
                if (b.enterprises === null) return -1;
                return b.enterprises - a.enterprises;
            });

            sortedCities.forEach((city, index) => {
                const item = document.createElement('div');
                item.className = 'city-item';
                if (city.isCustomer) {
                    item.innerHTML = `
                        <span class="city-name">${index + 1}. ${city.name}</span>
                        <span class="city-count" style="color: #6b7280;">Customer</span>
                    `;
                } else {
                    item.innerHTML = `
                        <span class="city-name">${index + 1}. ${city.name}</span>
                        <span class="city-count">${city.enterprises}</span>
                    `;
                }
                item.style.borderLeft = `3px solid ${regionColors[city.region]}`;

                item.addEventListener('click', () => {
                    map.setView([city.lat, city.lng], 6);
                    const markerData = markers.find(m => m.city.name === city.name);
                    if (markerData) {
                        markerData.marker.openPopup();
                    }
                });

                cityList.appendChild(item);
            });
        }

        // Initialize city list with all cities
        populateCityList('all');

        // Add click handlers to stat cards for filtering
        const statCards = document.querySelectorAll('.stat-card[data-region]');
        statCards.forEach(card => {
            card.addEventListener('click', () => {
                // Remove active class from all cards
                statCards.forEach(c => c.classList.remove('active'));
                // Add active class to clicked card
                card.classList.add('active');
                // Filter city list
                const region = card.dataset.region;
                populateCityList(region);
            });
        });
    </script>
</body>
</html>
